<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalkulator Weton ‚Äì Analisa Jodoh & Hari Baik</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Export PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    /* Palet coklat Jawa */
    :root{
      --coklat-900:#3d2b1f; --coklat-800:#4e342e; --coklat-700:#6b4226; --coklat-600:#8d6e63;
      --coklat-200:#efebe9; --coklat-100:#f7f2ee; --amber:#f6d087;
    }
    /* Background batik halus */
    .bg-batik {
      background:
        radial-gradient(circle at 8% 10%, rgba(246,208,135,.25) 0 22%, transparent 23%),
        radial-gradient(circle at 92% 90%, rgba(246,208,135,.25) 0 22%, transparent 23%),
        linear-gradient(135deg, rgba(141,110,99,.08) 25%, transparent 25%) -12px 0/24px 24px,
        linear-gradient(225deg, rgba(141,110,99,.08) 25%, transparent 25%) -12px 0/24px 24px,
        linear-gradient(315deg, rgba(141,110,99,.08) 25%, transparent 25%) 0px 0/24px 24px,
        linear-gradient(45deg,  rgba(141,110,99,.08) 25%, transparent 25%) 0px 0/24px 24px;
    }
    /* Kartu berbingkai motif */
    .kartu-batik {
      position: relative;
      border: 2px solid var(--amber);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(61,43,31,.15);
      overflow: hidden;
      background: #fff;
    }
    .kartu-batik.dark { background:#1f1b18; border-color:#d8b373; }
    .kartu-batik::before,
    .kartu-batik::after{
      content:"";
      position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(ellipse at top left, rgba(246,208,135,.20), transparent 60%),
        radial-gradient(ellipse at bottom right, rgba(246,208,135,.20), transparent 60%);
      mix-blend-mode:multiply;
    }
    /* Pita judul */
    .pita{
      background: linear-gradient(90deg, var(--coklat-900), var(--coklat-700));
      color:#f9efe6; border-radius: 999px;
      box-shadow: 0 6px 20px rgba(61,43,31,.25);
    }
    /* Badge logo aksara */
    .badge-aksara{
      background: radial-gradient(circle at 30% 30%, #f4d39a, #e1b96f);
      color: var(--coklat-900);
      border: 3px double var(--coklat-900);
    }
    /* Tombol coklat */
    .btn-coklat{ background: var(--coklat-700); }
    .btn-coklat:hover{ background: var(--coklat-800); }
    .btn-out{ border:1px solid var(--coklat-700); color: var(--coklat-700); }
    .btn-out:hover{ background: var(--coklat-700); color:#fff; }
    /* Section judul */
    .judul-sec{ color: var(--coklat-900); }
    .judul-sec.dark{ color:#f6e9d7; }
    /* PDF ornamen pada kartu hasil */
    .ornamen::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(circle at 8% 12%, rgba(246,208,135,.25) 0 18%, transparent 19%),
        radial-gradient(circle at 92% 88%, rgba(246,208,135,.25) 0 18%, transparent 19%);
    }
  </style>
</head>
<body class="bg-[var(--coklat-100)] text-[var(--coklat-900)] transition-colors">
  <div class="max-w-5xl mx-auto py-8 px-4">

    <!-- Header -->
    <div class="bg-batik rounded-2xl p-5 md:p-7 border border-[var(--amber)] shadow-lg">
      <div class="flex items-center justify-between">
        <div class="text-sm opacity-80">Kalkulator Weton ‚Ä¢ Edisi Coklat Jawa</div>
        <button id="toggleTema" class="px-4 py-2 rounded-lg btn-out">Mode Coklat / Gelap</button>
      </div>
      <div class="text-center mt-4">
        <div class="inline-flex items-center gap-3 pita px-5 py-2">
          <div class="w-11 h-11 rounded-full grid place-content-center badge-aksara text-xl font-semibold">Í¶Æ</div>
          <div class="text-left">
            <h1 class="text-3xl md:text-4xl font-extrabold leading-tight">Kalkulator Weton</h1>
            <p class="text-xs md:text-sm opacity-90 -mt-0.5">Analisa Jodoh & Hari Baik Pernikahan (Primbon Jawa)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- FORM -->
    <form id="wetonForm" class="mt-8 grid md:grid-cols-2 gap-6">
      <div class="space-y-3">
        <label class="block text-sm font-semibold judul-sec" for="namaPria">Nama Pria</label>
        <input id="namaPria" type="text" class="w-full p-3 rounded-lg border bg-white/80" placeholder="Masukkan nama pria" required>
        <label class="block text-sm font-semibold judul-sec" for="tglPria">Tanggal Lahir Pria</label>
        <input id="tglPria" type="date" class="w-full p-3 rounded-lg border bg-white/80" required>
      </div>
      <div class="space-y-3">
        <label class="block text-sm font-semibold judul-sec" for="namaWanita">Nama Wanita</label>
        <input id="namaWanita" type="text" class="w-full p-3 rounded-lg border bg-white/80" placeholder="Masukkan nama wanita" required>
        <label class="block text-sm font-semibold judul-sec" for="tglWanita">Tanggal Lahir Wanita</label>
        <input id="tglWanita" type="date" class="w-full p-3 rounded-lg border bg-white/80" required>
      </div>
      <div class="md:col-span-2 flex flex-wrap gap-3 justify-center">
        <button type="submit" class="px-6 py-2 rounded-lg text-white font-semibold btn-coklat">Proses</button>
        <button type="button" id="btnReset" class="px-6 py-2 rounded-lg font-semibold btn-out">Reset</button>
      </div>
    </form>

    <!-- HASIL -->
    <section id="hasil" class="mt-8 hidden">
      <div id="hasilCard" class="kartu-batik ornamen p-6 md:p-8">
        <!-- Header PDF -->
        <div class="flex items-center gap-4 mb-6">
          <div class="shrink-0 rounded-full w-16 h-16 grid place-content-center badge-aksara text-2xl font-bold">Í¶ÆÍ¶º</div>
          <div>
            <div class="text-2xl md:text-3xl font-extrabold" style="color:var(--coklat-900)">Kalkulator Weton</div>
            <div class="text-xs opacity-80">Analisa Jodoh & Hari Baik ‚Ä¢ Nuansa Coklat Jawa</div>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-bold text-lg" style="color:var(--coklat-900)">üë§ Data Pria</h3>
            <div id="dataPria" class="text-sm md:text-base mt-1 space-y-1"></div>
          </div>
          <div>
            <h3 class="font-bold text-lg" style="color:var(--coklat-900)">üë© Data Wanita</h3>
            <div id="dataWanita" class="text-sm md:text-base mt-1 space-y-1"></div>
          </div>
        </div>

        <hr class="my-6 border-[var(--amber)]/60" />

        <div>
          <h3 class="font-bold text-lg" style="color:var(--coklat-900)">üíë Kecocokan Jodoh</h3>
          <div id="kecocokan" class="mt-2 text-sm md:text-base leading-relaxed"></div>
        </div>

        <div class="mt-6">
          <h3 class="font-bold text-lg" style="color:var(--coklat-900)">üß© Analisa Kombinasi Spesifik</h3>
          <div id="analisaKombinasi" class="mt-2 text-sm md:text-base leading-relaxed"></div>
        </div>

        <div class="mt-6">
          <h3 class="font-bold text-lg" style="color:var(--coklat-900)">üìÖ Saran Hari / Pasaran Nikah</h3>
          <ul id="saranHari" class="mt-2 list-disc list-inside text-sm md:text-base leading-relaxed space-y-1"></ul>
        </div>
      </div>

      <div class="mt-5 flex flex-wrap gap-3">
        <button id="btnCetak" class="px-5 py-2 rounded-lg text-white font-semibold" style="background:var(--coklat-700)">Unduh PDF</button>
        <button id="btnShare" class="px-5 py-2 rounded-lg text-white font-semibold" style="background:linear-gradient(90deg,#4e342e,#6b4226)">Bagikan</button>
        <button id="btnWA" class="px-5 py-2 rounded-lg text-white font-semibold" style="background:#2ea043">Bagikan ke WhatsApp</button>
        <button id="btnCopy" class="px-5 py-2 rounded-lg font-semibold btn-out">Salin Ringkasan</button>
      </div>
      <p id="shareHint" class="mt-2 text-xs opacity-70"></p>
    </section>
  </div>

<script>
// ==========================
// Tema (coklat <-> gelap)
// ==========================
const root = document.documentElement;
const toggleBtn = document.getElementById('toggleTema');
toggleBtn.addEventListener('click', () => {
  const card = document.getElementById('hasilCard');
  const isDark = root.classList.toggle('dark');
  if (card) card.classList.toggle('dark', isDark);
  document.body.style.background = isDark ? '#1b1714' : 'var(--coklat-100)';
  document.body.style.color = isDark ? '#f6e9d7' : 'var(--coklat-900)';
});

// ==========================
// Data dasar weton & karakter
// ==========================
const PASARAN = ["Legi","Pahing","Pon","Wage","Kliwon"];
const HARI     = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const NEPTU_HARI     = {Minggu:5, Senin:4, Selasa:3, Rabu:7, Kamis:8, Jumat:6, Sabtu:9};
const NEPTU_PASARAN  = {Legi:5, Pahing:9, Pon:7, Wage:4, Kliwon:8};

const KARAKTER_HARI = {
  "Minggu":"berjiwa bebas, optimis, senang tampil di depan.",
  "Senin":"tenang, penuh pertimbangan, peduli detail.",
  "Selasa":"tegas, berenergi, kadang terburu-buru.",
  "Rabu":"logis, komunikatif, solutif.",
  "Kamis":"bijak, terstruktur, perfeksionis.",
  "Jumat":"hangat, romantis, mudah bekerja sama.",
  "Sabtu":"kuat pendirian, setia, sedikit kaku."
};

const KARAKTER_PASARAN = {
  "Legi":"penyayang, damai, mengutamakan keharmonisan.",
  "Pahing":"ambisius, daya juang tinggi, cenderung dominan.",
  "Pon":"stabil, rasional, suka keteraturan.",
  "Wage":"introvert, reflektif, sensitif.",
  "Kliwon":"intuisi tajam, spiritual, mudah berempati."
};

// ==========================
// Kategori hasil jodoh (detail)
// ==========================
const KATEGORI = [
  {keys:[7,14,21,28,35], name:"üü• Pegat (Pisah/Cerai)", html:`<p><strong>Makna:</strong> Pegat berarti ‚Äúpisah‚Äù. Menunjukkan potensi besar pertengkaran, krisis rumah tangga, hingga perceraian.</p>
    <p class='mt-2'><strong>Penyebab spesifik:</strong></p>
    <ul class='list-disc list-inside'>
      <li>Perbedaan prinsip hidup mencolok.</li>
      <li>Emosi tidak stabil, sama-sama keras kepala.</li>
      <li>Energi batin tidak menyatu, menimbulkan ketegangan.</li>
      <li>Ketidakseimbangan peran (satu dominan, satu mengalah).</li>
      <li>Gangguan pihak ketiga (perselingkuhan).</li>
      <li>Rezeki rumah tangga cenderung seret.</li>
    </ul>
    <p class='mt-2'><strong>Solusi tradisional:</strong> Ruwatan/tolak bala (siraman, tumpengan weton), memperkuat komunikasi dan spiritualitas bersama.</p>`},
  {keys:[8,15,22,29], name:"üü© Ratu (Raja & Ratu)", html:`<p><strong>Makna:</strong> Pasangan seperti raja dan ratu; sangat serasi lahir batin.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Energi spiritual sangat harmonis.</li>
      <li>Saling menguatkan dan memahami secara alami.</li>
      <li>Cinta dalam dan langgeng; rezeki terbuka lebar.</li>
      <li>Sering dianggap pasangan idaman.</li>
    </ul>
    <p class='mt-2'><strong>Catatan:</strong> Tetap rendah hati agar tidak muncul ketimpangan peran.</p>`},
  {keys:[9,16,23,30], name:"üü® Jodoh", html:`<p><strong>Makna:</strong> Jodoh alamiah, berjodoh secara spiritual maupun nasib.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Komunikasi nyambung.</li>
      <li>Karakter saling menutupi kekurangan.</li>
      <li>Potensi anak-anak yang membawa berkah.</li>
      <li>Sering dipertemukan oleh ‚Äútakdir‚Äù.</li>
    </ul>
    <p class='mt-2'><strong>Tantangan:</strong> Hambatan eksternal (ekonomi/status) bisa muncul; bukan masalah batin.</p>`},
  {keys:[10,17,24,31], name:"üü™ Topo (Bertapa/Ujian Hidup)", html:`<p><strong>Makna:</strong> Rumah tangga penuh ujian; seperti sedang ‚Äúbertapa‚Äù.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Ujian ekonomi, kesehatan, jarak, atau godaan luar.</li>
      <li>Kalau tidak saling dukung, bisa saling menjatuhkan.</li>
      <li>Anak sulit diatur bila orang tua tidak kompak.</li>
    </ul>
    <p class='mt-2'><strong>Filosofi:</strong> Mampu melewati ujian ‚Üí naik derajat spiritual & rezeki terbuka.</p>`},
  {keys:[11,18,25,32], name:"üü¶ Tinari (Untung/Beruntung)", html:`<p><strong>Makna:</strong> Pasangan yang sering mendapat keberuntungan.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Urusan lancar, rezeki relatif mudah.</li>
      <li>Jarang sakit-sakitan; anak membawa hoki.</li>
    </ul>
    <p class='mt-2'><strong>Catatan:</strong> Jangan terlena; tetap jaga pondasi spiritual & komunikasi.</p>`},
  {keys:[12,19,26,33], name:"üüß Padu (Bertengkar tapi tetap)", html:`<p><strong>Makna:</strong> Sering terjadi konflik kecil, tetapi tetap bersama.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Beda prinsip & ego tinggi ‚Üí adu argumen.</li>
      <li>Ikatan batin kuat; sulit berpisah.</li>
    </ul>
    <p class='mt-2'><strong>Saran:</strong> Latih sabar, komunikasi terbuka, dan manajemen emosi.</p>`},
  {keys:[13,20,27,34], name:"üü• Sujanan (Selingkuh/Dikhianati)", html:`<p><strong>Makna:</strong> Ada potensi pengkhianatan/orang ketiga.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Ketidakpuasan emosional/kurang dihargai.</li>
      <li>Energi batin tidak sinkron ‚Üí mudah curiga/posesif.</li>
    </ul>
    <p class='mt-2'><strong>Solusi:</strong> Kejujuran, terapi komunikasi, dan ruwatan weton bersama.</p>`}
];

// ==========================
// Analisa kombinasi spesifik pasaran (bisa dilengkapi 25 pasangan)
// ==========================
const KOMBO_SPESIFIK = {
  "Wage-Pahing":"Pribadi analitis & pendiam (Wage) bertemu energi kepemimpinan & ambisi (Pahing). Kuat di strategi; perlu melunak saat menyampaikan pendapat.",
  "Pahing-Wage":"Sosok dominan & visioner (Pahing) berpadu pasangan reflektif (Wage). Cocok untuk rencana jangka panjang; hindari mengatur berlebihan.",
  "Legi-Kliwon":"Kelembutan & harmoni (Legi) dipadu intuisi kuat (Kliwon). Hangat & religius.",
  "Pon-Wage":"Rasional & teratur (Pon) bertemu pendiam yang sensitif (Wage). Stabil, tapi rawan miskom jika perasaan dipendam.",
  "Kliwon-Pahing":"Intuisi kuat (Kliwon) + ambisi tinggi (Pahing). Daya dorong besar; seimbangkan batin & target duniawi."
};

// ==========================
// Perhitungan akurat (UTC-safe) + ANCHOR ala Kalenderize
// ==========================
// PATOKAN: 22 Sep 2025 = Senin Pahing
const ANCHOR_DATE_UTC    = Date.UTC(2025, 8, 22); // month 8 = September
const ANCHOR_PASARAN     = "Pahing";
const ANCHOR_INDEX       = PASARAN.indexOf(ANCHOR_PASARAN);
const mod = (n,m)=>((n%m)+m)%m;

function getPasaranUTC(y,m,d){
  const tUTC = Date.UTC(y, m-1, d);
  const diffDays = Math.floor((tUTC - ANCHOR_DATE_UTC)/86400000);
  const idx = mod(ANCHOR_INDEX + diffDays, 5);
  return PASARAN[idx];
}

function hitungWetonAkurat(y,m,d){
  const tUTC = Date.UTC(y, m-1, d);
  const dt = new Date(tUTC);
  const hari = HARI[dt.getUTCDay()];
  const pasaran = getPasaranUTC(y, m, d);
  const neptu = NEPTU_HARI[hari] + NEPTU_PASARAN[pasaran];
  return { hari, pasaran, neptu };
}

function hitungWetonFromInput(dateStr){
  const [yy, mm, dd] = dateStr.split("-").map(Number);
  return hitungWetonAkurat(yy, mm, dd);
}

// ==========================
// Util narasi & saran hari nikah
// ==========================
function kategoriDariTotal(total){
  for (const k of KATEGORI) if (k.keys.includes(total)) return k;
  return {name:"(Tidak Diketahui)", html:"Penentuan kategori untuk total ini belum tersedia."};
}
function gabunganKarakter(h, p){
  const hTone = {
    Minggu:"mandiri & ekspresif", Senin:"tenang & terukur", Selasa:"tegas & berani",
    Rabu:"logis & komunikatif", Kamis:"bijak & rapi", Jumat:"hangat & kooperatif", Sabtu:"setia & konsisten"
  }[h];
  const pTone = {
    Legi:"pelembut suasana", Pahing:"pendorong ambisi", Pon:"penjaga stabilitas",
    Wage:"pendalam batin", Kliwon:"penuntun intuisi"
  }[p];
  return `cenderung ${hTone}, dengan ${pTone}.`;
}
function karakterLengkap({hari, pasaran}){
  return `Hari <strong>${hari}</strong>: ${KARAKTER_HARI[hari]}<br/>Pasaran <strong>${pasaran}</strong>: ${KARAKTER_PASARAN[pasaran]}<br/><em>Gabungan:</em> ${gabunganKarakter(hari, pasaran)}`;
}
function buatSaranHari(pria, wanita, total){
  const katName = kategoriDariTotal(total).name;
  const duet = `${pria.pasaran}-${wanita.pasaran}`;
  const out = [];
  const push = (h, alasan)=>out.push(`<li><strong>${h}</strong> ‚Äî ${alasan}</li>`);

  if (katName.includes("Ratu") || katName.includes("Jodoh") || katName.includes("Tinari")){
    push("Jumat Legi", "Simbol harmoni & rezeki; cocok untuk pasangan yang selaras.");
    push("Rabu Pahing", "Menjernihkan batin & memantapkan niat bersama.");
  }
  if (katName.includes("Topo"))  push("Kamis Pon", "Menstabilkan ujian lahir-batin; baik untuk komitmen panjang.");
  if (katName.includes("Padu"))  push("Selasa Kliwon", "Energi tegas Selasa diseimbangkan keteduhan Kliwon, meredam ego.");
  if (katName.includes("Sujanan")) push("Minggu Pahing", "Menguatkan komitmen & kejujuran; merapikan arah hubungan.");
  if (katName.includes("Pegat")){
    push("Jumat Legi", "Diyakini membawa berkah & kedamaian; dianjurkan didahului doa/ruwatan.");
    push("Rabu Pahing", "Membersihkan energi tarik-tolak & meneguhkan niat.");
  }
  if (KOMBO_SPESIFIK[duet]) push("Kamis Kliwon", "Kombinasi batin-spiritual kuat; cocok untuk pasangan dengan dinamika batin mendalam.");
  if (!out.length) push("Jumat Legi", "Hari populer untuk awal rumah tangga yang damai dan berkah.");
  return out;
}

// ==========================
// Render & event handlers
// ==========================
const $ = s=>document.querySelector(s);

$('#btnReset').addEventListener('click', ()=>{
  $('#wetonForm').reset();
  $('#hasil').classList.add('hidden');
  $('#dataPria').innerHTML = '';
  $('#dataWanita').innerHTML = '';
  $('#kecocokan').innerHTML = '';
  $('#analisaKombinasi').innerHTML = '';
  $('#saranHari').innerHTML = '';
  $('#shareHint').textContent = '';
});

$('#wetonForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  const namaPria = $('#namaPria').value.trim();
  const namaWanita = $('#namaWanita').value.trim();
  const tPria = $('#tglPria').value;
  const tWanita = $('#tglWanita').value;
  if (!namaPria || !namaWanita || !tPria || !tWanita){ alert('Lengkapi semua data.'); return; }

  const pria = hitungWetonFromInput(tPria);
  const wanita = hitungWetonFromInput(tWanita);
  const total = pria.neptu + wanita.neptu;
  const kat = kategoriDariTotal(total);

  $('#dataPria').innerHTML = `
    <div><strong>Nama:</strong> ${namaPria}</div>
    <div><strong>Weton:</strong> ${pria.hari} ${pria.pasaran}</div>
    <div><strong>Neptu:</strong> ${pria.neptu}</div>
    <div class="mt-1">${karakterLengkap(pria)}</div>`;

  $('#dataWanita').innerHTML = `
    <div><strong>Nama:</strong> ${namaWanita}</div>
    <div><strong>Weton:</strong> ${wanita.hari} ${wanita.pasaran}</div>
    <div><strong>Neptu:</strong> ${wanita.neptu}</div>
    <div class="mt-1">${karakterLengkap(wanita)}</div>`;

  $('#kecocokan').innerHTML = `
    <div class="font-semibold">${kat.name}</div>
    <div class="mt-2">${kat.html}</div>
    <div class="mt-2"><strong>Total Neptu:</strong> ${total}</div>`;

  const duet = `${pria.pasaran}-${wanita.pasaran}`;
  const analisaKhusus = KOMBO_SPESIFIK[duet] ||
    "Belum ada analisa khusus untuk kombinasi ini. Gunakan prinsip umum: seimbangkan logika & rasa, serta jaga komunikasi.";
  $('#analisaKombinasi').innerHTML = `<p><strong>${pria.pasaran} + ${wanita.pasaran}</strong>: ${analisaKhusus}</p>`;

  const saran = buatSaranHari(pria, wanita, total);
  $('#saranHari').innerHTML = saran.join('');

  $('#hasil').classList.remove('hidden');
  $('#shareHint').textContent = '';

  // Ringkasan untuk share
  window._ringkasanText = `Kalkulator Weton\n\n`+
    `Pria: ${namaPria} (${pria.hari} ${pria.pasaran}, neptu ${pria.neptu})\n`+
    `Wanita: ${namaWanita} (${wanita.hari} ${wanita.pasaran}, neptu ${wanita.neptu})\n`+
    `Total Neptu: ${total} ‚Üí ${kat.name}\n`+
    `Saran Hari: ` + saran.map(li => li.replace(/<[^>]+>/g,'')).join(' | ');
});

// ==========================
// Export PDF (rapi, nuansa coklat & ornamen)
// ==========================
async function exportPDFNode(){
  const { jsPDF } = window.jspdf;
  const node = document.getElementById('hasilCard');

  const canvas = await html2canvas(node, {scale:2, backgroundColor:null});
  const img = canvas.toDataURL('image/png');

  const pdf = new jsPDF({orientation:'p', unit:'pt', format:'a4'});
  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();

  // Header
  pdf.setFillColor(247,242,238);
  pdf.rect(0,0,pageW,64,'F');
  pdf.setTextColor(61,43,31);
  pdf.setFontSize(18);
  pdf.text('Kalkulator Weton ‚Äì Analisa Jodoh & Hari Baik', 40, 40);

  // Konten
  const imgW = pageW - 60;
  const imgH = canvas.height * (imgW / canvas.width);
  pdf.addImage(img, 'PNG', 30, 84, imgW, imgH, '', 'FAST');

  // Footer
  pdf.setFontSize(9); pdf.setTextColor(120);
  const ts = new Date().toLocaleString('id-ID');
  pdf.text(`Dihasilkan oleh Kalkulator Weton ‚Ä¢ ${ts}`, 40, pageH - 20);

  return pdf;
}

document.getElementById('btnCetak').addEventListener('click', async ()=>{
  try{
    const pdf = await exportPDFNode();
    pdf.save('hasil-weton.pdf');
  }catch(e){ alert('Gagal membuat PDF. Coba lagi.'); }
});

// ==========================
// Share
// ==========================
document.getElementById('btnShare').addEventListener('click', async ()=>{
  const text = window._ringkasanText || 'Hasil belum dihitung.';
  if (navigator.share){
    try{ await navigator.share({title:'Hasil Kalkulator Weton', text}); return; }catch(e){}
  }
  await navigator.clipboard.writeText(text);
  document.getElementById('shareHint').textContent = 'Ringkasan disalin ke clipboard. Tempel di chat pilihan Anda.';
});

document.getElementById('btnWA').addEventListener('click', ()=>{
  const text = encodeURIComponent(window._ringkasanText || 'Hasil belum dihitung.');
  const url = `https://wa.me/?text=${text}`;
  try{ window.open(url,'_blank'); }
  catch(e){
    navigator.clipboard.writeText(window._ringkasanText || '');
    document.getElementById('shareHint').textContent = 'Tautan WhatsApp diblokir. Ringkasan disalin‚Äîtempel manual di WhatsApp.';
  }
});
</script>
</body>
</html>
