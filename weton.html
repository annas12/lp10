<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalkulator Weton â€“ Analisa Jodoh & Hari Baik</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Export PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    .ornamen::before{
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(circle at 8% 10%, rgba(255,224,178,.35) 0 20%, transparent 21%),
        radial-gradient(circle at 92% 90%, rgba(255,224,178,.35) 0 20%, transparent 21%);
      pointer-events:none;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors">
  <div class="max-w-4xl mx-auto py-8 px-4">
    <div class="flex items-center justify-between">
      <div class="text-sm opacity-70">Kalkulator Weton v3 (anchor kompatibel Kalenderize)</div>
      <button id="toggleDark" class="ml-4 bg-gray-700 hover:bg-gray-800 text-white font-semibold py-2 px-4 rounded">Dark Mode</button>
    </div>

    <div class="text-center mt-3">
      <div class="text-2xl font-semibold">ê¦ê¦­ê§€ê¦ê¦¸ê¦­ê¦¸ê¦ ê¦‚ Weton</div>
      <h1 class="text-3xl md:text-4xl font-bold mb-1">Analisa Jodoh & Hari Baik Pernikahan</h1>
      <p class="text-sm opacity-80">Berdasarkan hari, pasaran, dan neptu Jawa</p>
    </div>

    <!-- FORM -->
    <form id="wetonForm" class="mt-8 grid md:grid-cols-2 gap-6">
      <div class="space-y-3">
        <label class="block text-sm font-semibold" for="namaPria">Nama Pria</label>
        <input id="namaPria" type="text" class="w-full p-3 rounded border dark:bg-gray-800" placeholder="Masukkan nama pria" required>
        <label class="block text-sm font-semibold" for="tglPria">Tanggal Lahir Pria</label>
        <input id="tglPria" type="date" class="w-full p-3 rounded border dark:bg-gray-800" required>
      </div>
      <div class="space-y-3">
        <label class="block text-sm font-semibold" for="namaWanita">Nama Wanita</label>
        <input id="namaWanita" type="text" class="w-full p-3 rounded border dark:bg-gray-800" placeholder="Masukkan nama wanita" required>
        <label class="block text-sm font-semibold" for="tglWanita">Tanggal Lahir Wanita</label>
        <input id="tglWanita" type="date" class="w-full p-3 rounded border dark:bg-gray-800" required>
      </div>
      <div class="md:col-span-2 flex flex-wrap gap-3 justify-center">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">Proses</button>
        <button type="button" id="btnReset" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-6 rounded dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-gray-100">Reset</button>
      </div>
    </form>

    <!-- HASIL -->
    <section id="hasil" class="mt-8 hidden">
      <div id="hasilCard" class="relative ornamen bg-white dark:bg-gray-800 rounded-xl shadow p-6 md:p-8 overflow-hidden">
        <!-- Header PDF -->
        <div class="flex items-center gap-4 mb-6">
          <div class="shrink-0 rounded-full bg-amber-200/70 dark:bg-amber-300/20 w-14 h-14 grid place-content-center text-xl">ê¦®ê¦¼ê¦ ê¦ºê¦´ê¦¤ê§€</div>
          <div>
            <div class="text-xl md:text-2xl font-bold">Kalkulator Weton</div>
            <div class="text-xs opacity-70">Analisa Jodoh & Hari Baik</div>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold text-lg">ğŸ‘¤ Data Pria</h3>
            <div id="dataPria" class="text-sm md:text-base mt-1 space-y-1"></div>
          </div>
          <div>
            <h3 class="font-semibold text-lg">ğŸ‘© Data Wanita</h3>
            <div id="dataWanita" class="text-sm md:text-base mt-1 space-y-1"></div>
          </div>
        </div>

        <hr class="my-6 border-amber-200/60 dark:border-amber-300/20" />

        <div>
          <h3 class="font-semibold text-lg">ğŸ’‘ Kecocokan Jodoh</h3>
          <div id="kecocokan" class="mt-2 text-sm md:text-base leading-relaxed"></div>
        </div>

        <div class="mt-6">
          <h3 class="font-semibold text-lg">ğŸ§© Analisa Kombinasi Spesifik</h3>
          <div id="analisaKombinasi" class="mt-2 text-sm md:text-base leading-relaxed"></div>
        </div>

        <div class="mt-6">
          <h3 class="font-semibold text-lg">ğŸ“… Saran Hari / Pasaran Nikah</h3>
          <ul id="saranHari" class="mt-2 list-disc list-inside text-sm md:text-base leading-relaxed space-y-1"></ul>
        </div>
      </div>

      <div class="mt-5 flex flex-wrap gap-3">
        <button id="btnCetak" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-5 rounded">Unduh PDF</button>
        <button id="btnShare" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-5 rounded">Bagikan</button>
        <button id="btnWA" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-5 rounded">Bagikan ke WhatsApp</button>
        <button id="btnCopy" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-5 rounded dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-gray-100">Salin Ringkasan</button>
      </div>
      <p id="shareHint" class="mt-2 text-xs opacity-70"></p>
    </section>
  </div>

<script>
// ==========================
// Data dasar weton & karakter
// ==========================
const PASARAN = ["Legi","Pahing","Pon","Wage","Kliwon"]; // 0..4
const HARI     = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"]; // 0..6
const NEPTU_HARI     = {Minggu:5, Senin:4, Selasa:3, Rabu:7, Kamis:8, Jumat:6, Sabtu:9};
const NEPTU_PASARAN  = {Legi:5, Pahing:9, Pon:7, Wage:4, Kliwon:8};

const KARAKTER_HARI = {
  "Minggu":"berjiwa bebas, optimis, senang tampil di depan.",
  "Senin":"tenang, penuh pertimbangan, peduli detail.",
  "Selasa":"tegas, berenergi, kadang terburu-buru.",
  "Rabu":"logis, komunikatif, solutif.",
  "Kamis":"bijak, terstruktur, perfeksionis.",
  "Jumat":"hangat, romantis, mudah bekerja sama.",
  "Sabtu":"kuat pendirian, setia, sedikit kaku."
};

const KARAKTER_PASARAN = {
  "Legi":"penyayang, damai, mengutamakan keharmonisan.",
  "Pahing":"ambisius, daya juang tinggi, cenderung dominan.",
  "Pon":"stabil, rasional, suka keteraturan.",
  "Wage":"introvert, reflektif, sensitif.",
  "Kliwon":"intuisi tajam, spiritual, mudah berempati."
};

// ==========================
// Kategori hasil jodoh (detail sesuai brief kamu)
// ==========================
const KATEGORI = [
  {keys:[7,14,21,28,35], name:"ğŸŸ¥ Pegat (Pisah/Cerai)", html:`<p><strong>Makna:</strong> Pegat berarti â€œpisahâ€. Menunjukkan potensi besar pertengkaran, krisis rumah tangga, hingga perceraian.</p>
    <p class='mt-2'><strong>Penyebab spesifik:</strong></p>
    <ul class='list-disc list-inside'>
      <li>Perbedaan prinsip hidup mencolok.</li>
      <li>Emosi tidak stabil, sama-sama keras kepala.</li>
      <li>Energi batin tidak menyatu, menimbulkan ketegangan.</li>
      <li>Ketidakseimbangan peran (satu dominan, satu mengalah).</li>
      <li>Gangguan pihak ketiga (perselingkuhan).</li>
      <li>Rezeki rumah tangga cenderung seret.</li>
    </ul>
    <p class='mt-2'><strong>Solusi tradisional:</strong> Ruwatan/tolak bala (siraman, tumpengan weton), memperkuat komunikasi dan spiritualitas bersama.</p>`},
  {keys:[8,15,22,29], name:"ğŸŸ© Ratu (Raja & Ratu)", html:`<p><strong>Makna:</strong> Pasangan seperti raja dan ratu; sangat serasi lahir batin.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Energi spiritual sangat harmonis.</li>
      <li>Saling menguatkan dan memahami secara alami.</li>
      <li>Cinta dalam dan langgeng; rezeki terbuka lebar.</li>
      <li>Sering dianggap pasangan idaman.</li>
    </ul>
    <p class='mt-2'><strong>Catatan:</strong> Tetap rendah hati agar tidak muncul ketimpangan peran.</p>`},
  {keys:[9,16,23,30], name:"ğŸŸ¨ Jodoh", html:`<p><strong>Makna:</strong> Jodoh alamiah, berjodoh secara spiritual maupun nasib.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Komunikasi nyambung.</li>
      <li>Karakter saling menutupi kekurangan.</li>
      <li>Potensi anak-anak yang membawa berkah.</li>
      <li>Sering dipertemukan oleh â€œtakdirâ€.</li>
    </ul>
    <p class='mt-2'><strong>Tantangan:</strong> Hambatan eksternal (ekonomi/status) bisa muncul; bukan masalah batin.</p>`},
  {keys:[10,17,24,31], name:"ğŸŸª Topo (Bertapa/Ujian Hidup)", html:`<p><strong>Makna:</strong> Rumah tangga penuh ujian; seperti sedang â€œbertapaâ€.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Ujian ekonomi, kesehatan, jarak, atau godaan luar.</li>
      <li>Kalau tidak saling dukung, bisa saling menjatuhkan.</li>
      <li>Anak sulit diatur bila orang tua tidak kompak.</li>
    </ul>
    <p class='mt-2'><strong>Filosofi:</strong> Mampu melewati ujian â†’ naik derajat spiritual & rezeki terbuka.</p>`},
  {keys:[11,18,25,32], name:"ğŸŸ¦ Tinari (Untung/Beruntung)", html:`<p><strong>Makna:</strong> Pasangan yang sering mendapat keberuntungan.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Urusan lancar, rezeki relatif mudah.</li>
      <li>Jarang sakit-sakitan; anak membawa hoki.</li>
    </ul>
    <p class='mt-2'><strong>Catatan:</strong> Jangan terlena; tetap jaga pondasi spiritual & komunikasi.</p>`},
  {keys:[12,19,26,33], name:"ğŸŸ§ Padu (Bertengkar tapi tetap)", html:`<p><strong>Makna:</strong> Sering terjadi konflik kecil, tetapi tetap bersama.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Beda prinsip & ego tinggi â†’ adu argumen.</li>
      <li>Ikatan batin kuat; sulit berpisah.</li>
    </ul>
    <p class='mt-2'><strong>Saran:</strong> Latih sabar, komunikasi terbuka, dan manajemen emosi.</p>`},
  {keys:[13,20,27,34], name:"ğŸŸ¥ Sujanan (Selingkuh/Dikhianati)", html:`<p><strong>Makna:</strong> Ada potensi pengkhianatan/orang ketiga.</p>
    <ul class='list-disc list-inside mt-2'>
      <li>Ketidakpuasan emosional/kurang dihargai.</li>
      <li>Energi batin tidak sinkron â†’ mudah curiga/posesif.</li>
    </ul>
    <p class='mt-2'><strong>Solusi:</strong> Kejujuran, terapi komunikasi, dan ruwatan weton bersama.</p>`}
];

// ==========================
// Analisa kombinasi spesifik pasaran (bisa kamu lengkapi 25 pasangan penuh)
// ==========================
const KOMBO_SPESIFIK = {
  "Wage-Pahing":"Pribadi analitis & pendiam (Wage) bertemu energi kepemimpinan & ambisi (Pahing). Kuat di strategi; perlu melunak saat menyampaikan pendapat.",
  "Pahing-Wage":"Sosok dominan & visioner (Pahing) berpadu pasangan reflektif (Wage). Cocok untuk rencana jangka panjang; hindari mengatur berlebihan.",
  "Legi-Kliwon":"Kelembutan & harmoni (Legi) dipadu intuisi kuat (Kliwon). Hangat & religius.",
  "Pon-Wage":"Rasional & teratur (Pon) bertemu pendiam yang sensitif (Wage). Stabil, tapi rawan miskom jika perasaan dipendam.",
  "Kliwon-Pahing":"Intuisi kuat (Kliwon) + ambisi tinggi (Pahing). Daya dorong besar; seimbangkan batin & target duniawi."
};

// ==========================
// Perhitungan akurat (UTC-safe) + ANCHOR ala Kalenderize
// ==========================
// PATOKAN: 22 Sep 2025 = Senin Pahing (contoh yang cocok dengan Kalenderize)
const ANCHOR_DATE_UTC    = Date.UTC(2025, 8, 22); // 2025-09-22 (month 8 = September)
const ANCHOR_PASARAN     = "Pahing";
const ANCHOR_INDEX       = PASARAN.indexOf(ANCHOR_PASARAN);
const mod = (n,m)=>((n%m)+m)%m;

function getPasaranUTC(y,m,d){
  const tUTC = Date.UTC(y, m-1, d);
  const diffDays = Math.floor((tUTC - ANCHOR_DATE_UTC)/86400000);
  const idx = mod(ANCHOR_INDEX + diffDays, 5);
  return PASARAN[idx];
}

function hitungWetonAkurat(y,m,d){
  const tUTC = Date.UTC(y, m-1, d);
  const dt = new Date(tUTC);
  const hari = HARI[dt.getUTCDay()];
  const pasaran = getPasaranUTC(y, m, d);
  const neptu = NEPTU_HARI[hari] + NEPTU_PASARAN[pasaran];
  return { hari, pasaran, neptu };
}

function hitungWetonFromInput(dateStr){
  const [yy, mm, dd] = dateStr.split("-").map(Number);
  return hitungWetonAkurat(yy, mm, dd);
}

// ==========================
// Util narasi & saran hari nikah
// ==========================
function kategoriDariTotal(total){
  for (const k of KATEGORI) if (k.keys.includes(total)) return k;
  return {name:"(Tidak Diketahui)", html:"Penentuan kategori untuk total ini belum tersedia."};
}
function gabunganKarakter(h, p){
  const hTone = {
    Minggu:"mandiri & ekspresif", Senin:"tenang & terukur", Selasa:"tegas & berani",
    Rabu:"logis & komunikatif", Kamis:"bijak & rapi", Jumat:"hangat & kooperatif", Sabtu:"setia & konsisten"
  }[h];
  const pTone = {
    Legi:"pelembut suasana", Pahing:"pendorong ambisi", Pon:"penjaga stabilitas",
    Wage:"pendalam batin", Kliwon:"penuntun intuisi"
  }[p];
  return `cenderung ${hTone}, dengan ${pTone}.`;
}
function karakterLengkap({hari, pasaran}){
  return `Hari <strong>${hari}</strong>: ${KARAKTER_HARI[hari]}<br/>Pasaran <strong>${pasaran}</strong>: ${KARAKTER_PASARAN[pasaran]}<br/><em>Gabungan:</em> ${gabunganKarakter(hari, pasaran)}`;
}

function buatSaranHari(pria, wanita, total){
  const katName = kategoriDariTotal(total).name;
  const duet = `${pria.pasaran}-${wanita.pasaran}`;
  const out = [];
  const push = (h, alasan)=>out.push(`<li><strong>${h}</strong> â€” ${alasan}</li>`);

  if (katName.includes("Ratu") || katName.includes("Jodoh") || katName.includes("Tinari")){
    push("Jumat Legi", "Simbol harmoni & rezeki; cocok untuk pasangan yang selaras.");
    push("Rabu Pahing", "Menjernihkan batin & memantapkan niat bersama.");
  }
  if (katName.includes("Topo"))  push("Kamis Pon", "Menstabilkan ujian lahir-batin; baik untuk komitmen panjang.");
  if (katName.includes("Padu"))  push("Selasa Kliwon", "Energi tegas Selasa diseimbangkan keteduhan Kliwon, meredam ego.");
  if (katName.includes("Sujanan")) push("Minggu Pahing", "Menguatkan komitmen & kejujuran; merapikan arah hubungan.");
  if (katName.includes("Pegat")){
    push("Jumat Legi", "Diyakini membawa berkah & kedamaian; dianjurkan didahului doa/ruwatan.");
    push("Rabu Pahing", "Membersihkan energi tarik-tolak & meneguhkan niat.");
  }

  if (KOMBO_SPESIFIK[duet]){
    push("Kamis Kliwon", "Kombinasi batin-spiritual kuat; cocok untuk pasangan dengan dinamika batin mendalam.");
  }
  if (!out.length){
    push("Jumat Legi", "Hari populer untuk awal rumah tangga yang damai dan berkah.");
  }
  return out;
}

// ==========================
// Render & event handlers
// ==========================
const $ = s=>document.querySelector(s);

$('#toggleDark').addEventListener('click', ()=>{
  document.documentElement.classList.toggle('dark');
});
$('#btnReset').addEventListener('click', ()=>{
  $('#wetonForm').reset();
  $('#hasil').classList.add('hidden');
  $('#dataPria').innerHTML = '';
  $('#dataWanita').innerHTML = '';
  $('#kecocokan').innerHTML = '';
  $('#analisaKombinasi').innerHTML = '';
  $('#saranHari').innerHTML = '';
  $('#shareHint').textContent = '';
});

$('#wetonForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  const namaPria = $('#namaPria').value.trim();
  const namaWanita = $('#namaWanita').value.trim();
  const tPria = $('#tglPria').value;
  const tWanita = $('#tglWanita').value;
  if (!namaPria || !namaWanita || !tPria || !tWanita){ alert('Lengkapi semua data.'); return; }

  const pria = hitungWetonFromInput(tPria);
  const wanita = hitungWetonFromInput(tWanita);
  const total = pria.neptu + wanita.neptu;
  const kat = kategoriDariTotal(total);

  $('#dataPria').innerHTML = `
    <div><strong>Nama:</strong> ${namaPria}</div>
    <div><strong>Weton:</strong> ${pria.hari} ${pria.pasaran}</div>
    <div><strong>Neptu:</strong> ${pria.neptu}</div>
    <div class="mt-1">${karakterLengkap(pria)}</div>`;

  $('#dataWanita').innerHTML = `
    <div><strong>Nama:</strong> ${namaWanita}</div>
    <div><strong>Weton:</strong> ${wanita.hari} ${wanita.pasaran}</div>
    <div><strong>Neptu:</strong> ${wanita.neptu}</div>
    <div class="mt-1">${karakterLengkap(wanita)}</div>`;

  $('#kecocokan').innerHTML = `
    <div class="font-semibold">Kategori: ${kat.name}</div>
    <div class="mt-2">${kat.html}</div>
    <div class="mt-2"><strong>Total Neptu:</strong> ${total}</div>`;

  const duet = `${pria.pasaran}-${wanita.pasaran}`;
  const analisaKhusus = KOMBO_SPESIFIK[duet] ||
    "Belum ada analisa khusus untuk kombinasi ini. Gunakan prinsip umum: seimbangkan logika & rasa, serta jaga komunikasi.";
  $('#analisaKombinasi').innerHTML = `<p><strong>${pria.pasaran} + ${wanita.pasaran}</strong>: ${analisaKhusus}</p>`;

  const saran = buatSaranHari(pria, wanita, total);
  $('#saranHari').innerHTML = saran.join('');

  $('#hasil').classList.remove('hidden');
  $('#shareHint').textContent = '';

  // Ringkasan untuk share
  window._ringkasanText = `Kalkulator Weton\n\n`+
    `Pria: ${namaPria} (${pria.hari} ${pria.pasaran}, neptu ${pria.neptu})\n`+
    `Wanita: ${namaWanita} (${wanita.hari} ${wanita.pasaran}, neptu ${wanita.neptu})\n`+
    `Total Neptu: ${total} â†’ ${kat.name}\n`+
    `Saran Hari: ` + saran.map(li => li.replace(/<[^>]+>/g,'')).join(' | ');
});

// ==========================
// Export PDF (rapi, logo & ornamen)
// ==========================
async function exportPDFNode(){
  const { jsPDF } = window.jspdf;
  const node = document.getElementById('hasilCard');

  const canvas = await html2canvas(node, {scale:2, backgroundColor:null});
  const img = canvas.toDataURL('image/png');

  const pdf = new jsPDF({orientation:'p', unit:'pt', format:'a4'});
  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();

  // Header
  pdf.setFillColor(255,245,235);
  pdf.rect(0,0,pageW,60,'F');
  pdf.setTextColor(90,55,20);
  pdf.setFontSize(16);
  pdf.text('Kalkulator Weton â€“ Analisa Jodoh & Hari Baik', 40, 38);

  // Konten
  const imgW = pageW - 60;
  const imgH = canvas.height * (imgW / canvas.width);
  pdf.addImage(img, 'PNG', 30, 80, imgW, imgH, '', 'FAST');

  // Footer
  pdf.setFontSize(9); pdf.setTextColor(120);
  const ts = new Date().toLocaleString('id-ID');
  pdf.text(`Dihasilkan oleh Kalkulator Weton â€¢ ${ts}`, 40, pageH - 20);

  return pdf;
}

document.getElementById('btnCetak').addEventListener('click', async ()=>{
  try{
    const pdf = await exportPDFNode();
    pdf.save('hasil-weton.pdf');
  }catch(e){ alert('Gagal membuat PDF. Coba lagi.'); }
});

// ==========================
// Share
// ==========================
document.getElementById('btnShare').addEventListener('click', async ()=>{
  const text = window._ringkasanText || 'Hasil belum dihitung.';
  if (navigator.share){
    try{ await navigator.share({title:'Hasil Kalkulator Weton', text}); return; }catch(e){}
  }
  await navigator.clipboard.writeText(text);
  document.getElementById('shareHint').textContent = 'Ringkasan disalin ke clipboard. Tempel di chat pilihan Anda.';
});

document.getElementById('btnWA').addEventListener('click', ()=>{
  const text = encodeURIComponent(window._ringkasanText || 'Hasil belum dihitung.');
  const url = `https://wa.me/?text=${text}`;
  try{ window.open(url,'_blank'); }
  catch(e){
    navigator.clipboard.writeText(window._ringkasanText || '');
    document.getElementById('shareHint').textContent = 'Tautan WhatsApp diblokir. Ringkasan disalinâ€”tempel manual di WhatsApp.';
  }
});
</script>
</body>
</html>
