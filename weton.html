<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Kalkulator Weton – Analisa Jodoh & Hari Baik</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Export PDF libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    :root{
      --coklat-950:#2b2018; --coklat-900:#3d2b1f; --coklat-800:#4e342e; --coklat-700:#6b4226; --coklat-600:#8d6e63;
      --coklat-300:#d7ccc8; --coklat-200:#efebe9; --coklat-100:#f7f2ee; --amber:#f6d087;
    }
    body{ background:var(--coklat-100); color:var(--coklat-900); }
    .bg-batik {
      background:
        radial-gradient(circle at 8% 10%, rgba(246,208,135,.18) 0 20%, transparent 21%),
        radial-gradient(circle at 92% 90%, rgba(246,208,135,.18) 0 20%, transparent 21%);
    }
    .kartu-batik {
      position: relative;
      border: 2px solid var(--amber);
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(61,43,31,.12);
      overflow: hidden;
      background: #fff;
      isolation:isolate;
    }
    .kartu-batik.dark { background:#1f1b18; border-color:#d8b373; }
    .kartu-batik::before{
      content:""; position:absolute; inset:0; pointer-events:none; z-index:0;
      background:
        radial-gradient(ellipse at top left, rgba(246,208,135,.16), transparent 60%),
        radial-gradient(ellipse at bottom right, rgba(246,208,135,.16), transparent 60%);
    }
    .ornamen-wrap{ position:relative; }
    .ornamen-top-left, .ornamen-bottom-right{
      position:absolute; width:100px; height:100px; opacity:.35; z-index:1; pointer-events:none;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.06));
    }
    .ornamen-top-left{ top:-6px; left:-6px; }
    .ornamen-bottom-right{ bottom:-6px; right:-6px; transform: rotate(180deg); }

    .btn-coklat{ background: var(--coklat-700); color:#fff; }
    .btn-coklat:hover{ background: var(--coklat-800); }
    .btn-out{ border:1px solid var(--coklat-700); color: var(--coklat-700); }
    .btn-out:hover{ background: var(--coklat-700); color:#fff; }

    .icon-btn{
      width:40px; height:40px; display:grid; place-items:center; border-radius:999px;
      border:1px solid rgba(61,43,31,.2); background:#fff;
    }
    .icon-btn:hover{ background:#fff7ee; }
    .dark .icon-btn{ background:#2a241f; border-color:#6b5a4a; }
    .dark .icon-btn:hover{ background:#3a3028; }

    .pdf-stable *{
      transform:none !important; filter:none !important; backdrop-filter:none !important;
      -webkit-transform:none !important; -webkit-filter:none !important;
    }
    .pdf-stable{ box-shadow:none !important; }
    @media (max-width: 420px){
      .ornamen-top-left, .ornamen-bottom-right{ width:78px; height:78px; }
    }
  </style>
</head>
<body>
  <!-- SVG defs -->
  <svg width="0" height="0" style="position:absolute">
    <defs>
      <linearGradient id="gradBatik" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#f6d087"/>
        <stop offset="100%" stop-color="#e1b96f"/>
      </linearGradient>
      <g id="motifBunga">
        <circle cx="20" cy="20" r="12" fill="url(#gradBatik)" stroke="#6b4226" stroke-width="2"/>
        <path d="M20 5 L24 16 L36 20 L24 24 L20 35 L16 24 L4 20 L16 16 Z" fill="none" stroke="#6b4226" stroke-width="2"/>
      </g>
      <g id="wayangHead">
        <path d="M20 5 C10 10, 8 22, 20 28 C32 22,30 10,20 5 Z" fill="url(#gradBatik)" stroke="#3d2b1f" stroke-width="2"/>
        <circle cx="17" cy="17" r="2.5" fill="#3d2b1f"/>
      </g>
    </defs>
  </svg>

  <div class="max-w-5xl mx-auto px-3 sm:px-4">
    <!-- HEADER -->
    <header class="flex items-center justify-between py-2">
      <div class="flex items-center gap-2">
        <div class="w-9 h-9 rounded-full grid place-content-center border border-[var(--amber)] bg-batik">
          <svg viewBox="0 0 40 40" width="22" height="22" aria-hidden="true"><use href="#wayangHead"></use></svg>
        </div>
        <span class="text-base font-semibold tracking-tight">Kalkulator Weton</span>
      </div>
      <div class="flex items-center gap-2">
        <!-- Tombol refresh (ikon) -->
        <button id="btnRefresh" class="icon-btn" aria-label="Muat ulang">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17.65 6.35A7.95 7.95 0 0012 4a8 8 0 108 8h-2a6 6 0 11-6-6c1.66 0 3.14.67 4.22 1.76L13 11h7V4l-2.35 2.35z"/>
          </svg>
        </button>
        <!-- Toggle tema -->
        <button id="toggleTema" class="icon-btn" aria-label="Ganti tema">
          <svg id="iconMoon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="text-[var(--coklat-900)] dark:hidden">
            <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/>
          </svg>
          <svg id="iconSun" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#f6d087" class="hidden dark:block">
            <path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zM1 13h3v-2H1v2zm10 10h2v-3h-2v3zM4.95 19.07l1.41 1.41 1.8-1.79-1.41-1.41-1.8 1.79zM13 1h-2v3h2V1zm7.05 4.93l-1.41-1.41-1.8 1.79 1.41 1.41 1.8-1.79zM20 11v2h3v-2h-3zm-8 2a3 3 0 110-6 3 3 0 010 6zm7.05 6.07l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42z"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- FORM -->
    <form id="wetonForm" class="mt-3 grid md:grid-cols-2 gap-4 sm:gap-6">
      <div class="space-y-3">
        <label class="block text-sm font-semibold" for="namaPria">Nama Pria</label>
        <input id="namaPria" type="text" class="w-full p-3 rounded-lg border bg-white/80" placeholder="Masukkan nama pria" required>
        <label class="block text-sm font-semibold" for="tglPria">Tanggal Lahir Pria</label>
        <input id="tglPria" type="date" class="w-full p-3 rounded-lg border bg-white/80" required>
      </div>
      <div class="space-y-3">
        <label class="block text-sm font-semibold" for="namaWanita">Nama Wanita</label>
        <input id="namaWanita" type="text" class="w-full p-3 rounded-lg border bg-white/80" placeholder="Masukkan nama wanita" required>
        <label class="block text-sm font-semibold" for="tglWanita">Tanggal Lahir Wanita</label>
        <input id="tglWanita" type="date" class="w-full p-3 rounded-lg border bg-white/80" required>
      </div>
      <div class="md:col-span-2 flex flex-wrap gap-3 justify-center">
        <button type="submit" class="px-6 py-2 rounded-lg text-white font-semibold btn-coklat">Proses</button>
        <button type="button" id="btnReset" class="px-6 py-2 rounded-lg font-semibold btn-out">Reset</button>
      </div>
    </form>

    <!-- HASIL -->
    <section id="hasil" class="mt-5 hidden">
      <div class="ornamen-wrap">
        <svg class="ornamen-top-left" viewBox="0 0 40 40" aria-hidden="true"><use href="#motifBunga"></use></svg>
        <svg class="ornamen-bottom-right" viewBox="0 0 40 40" aria-hidden="true"><use href="#motifBunga"></use></svg>

        <div id="hasilCard" class="kartu-batik p-5 sm:p-6 md:p-8">
          <div class="relative z-10 flex items-center gap-3 mb-4">
            <div class="shrink-0 rounded-full w-12 h-12 grid place-content-center border border-[var(--amber)] bg-batik">
              <svg viewBox="0 0 40 40" width="24" height="24" aria-hidden="true"><use href="#wayangHead"></use></svg>
            </div>
            <div>
              <div class="text-xl md:text-2xl font-extrabold" style="color:var(--coklat-900)">Kalkulator Weton</div>
              <div class="text-[11px] opacity-80">Analisa Jodoh & Hari Baik</div>
            </div>
          </div>

          <div class="relative z-10 grid md:grid-cols-2 gap-6">
            <div>
              <h3 class="font-bold text-lg" style="color:var(--coklat-900)">👤 Data Pria</h3>
              <div id="dataPria" class="text-sm md:text-base mt-1 space-y-1"></div>
            </div>
            <div>
              <h3 class="font-bold text-lg" style="color:var(--coklat-900)">👩 Data Wanita</h3>
              <div id="dataWanita" class="text-sm md:text-base mt-1 space-y-1"></div>
            </div>
          </div>

          <hr class="my-5 border-[var(--amber)]/60 relative z-10" />

          <div class="relative z-10">
            <h3 class="font-bold text-lg" style="color:var(--coklat-900)">💑 Kecocokan Jodoh</h3>
            <div id="kecocokan" class="mt-2 text-sm md:text-base leading-relaxed"></div>
          </div>

          <div class="mt-6 relative z-10">
            <h3 class="font-bold text-lg" style="color:var(--coklat-900)">🧩 Analisa Kombinasi Spesifik</h3>
            <div id="analisaKombinasi" class="mt-2 text-sm md:text-base leading-relaxed"></div>
          </div>

          <div class="mt-6 relative z-10">
            <h3 class="font-bold text-lg" style="color:var(--coklat-900)">📅 Saran Hari / Pasaran Nikah</h3>
            <ul id="saranHari" class="mt-2 list-disc list-inside text-sm md:text-base leading-relaxed space-y-1"></ul>
          </div>
        </div>
      </div>

      <div class="mt-4 flex flex-wrap gap-3">
        <button id="btnCetak" class="px-5 py-2 rounded-lg text-white font-semibold" style="background:var(--coklat-700)">Unduh PDF</button>
        <button id="btnShare" class="px-5 py-2 rounded-lg text-white font-semibold" style="background:linear-gradient(90deg,#4e342e,#6b4226)">Bagikan</button>
        <button id="btnWA" class="px-5 py-2 rounded-lg text-white font-semibold" style="background:#2ea043">Bagikan ke WhatsApp</button>
        <button id="btnCopy" class="px-5 py-2 rounded-lg font-semibold btn-out">Salin Ringkasan</button>
      </div>
      <p id="shareHint" class="mt-2 text-xs opacity-70"></p>
    </section>
  </div>

<script>
/* ===== Tema ===== */
const root = document.documentElement;
document.getElementById('toggleTema').addEventListener('click', () => {
  const card = document.getElementById('hasilCard');
  const isDark = root.classList.toggle('dark');
  if (card) card.classList.toggle('dark', isDark);
  document.body.style.background = isDark ? '#1b1714' : 'var(--coklat-100)';
  document.body.style.color = isDark ? '#f6e9d7' : 'var(--coklat-900)';
});

/* ===== Refresh icon ===== */
document.getElementById('btnRefresh').addEventListener('click', ()=> location.reload());

/* ===== Data dasar weton & karakter ===== */
const PASARAN = ["Legi","Pahing","Pon","Wage","Kliwon"];
const HARI     = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
const NEPTU_HARI     = {Minggu:5, Senin:4, Selasa:3, Rabu:7, Kamis:8, Jumat:6, Sabtu:9};
const NEPTU_PASARAN  = {Legi:5, Pahing:9, Pon:7, Wage:4, Kliwon:8};

const KARAKTER_HARI = {
  "Minggu":"berjiwa bebas, optimis, senang tampil di depan.",
  "Senin":"tenang, penuh pertimbangan, peduli detail.",
  "Selasa":"tegas, berenergi, kadang terburu-buru.",
  "Rabu":"logis, komunikatif, solutif.",
  "Kamis":"bijak, terstruktur, perfeksionis.",
  "Jumat":"hangat, romantis, mudah bekerja sama.",
  "Sabtu":"kuat pendirian, setia, sedikit kaku."
};
const KARAKTER_PASARAN = {
  "Legi":"penyayang, damai, mengutamakan keharmonisan.",
  "Pahing":"ambisius, daya juang tinggi, cenderung dominan.",
  "Pon":"stabil, rasional, suka keteraturan.",
  "Wage":"introvert, reflektif, sensitif.",
  "Kliwon":"intuisi tajam, spiritual, mudah berempati."
};

/* ===== Kategori hasil jodoh ===== */
const KATEGORI = [
  {keys:[7,14,21,28,35], name:"🟥 Pegat (Pisah/Cerai)", html:`<p><strong>Makna:</strong> Pegat berarti “pisah”. Menunjukkan potensi besar pertengkaran, krisis rumah tangga, hingga perceraian.</p>
    <p class='mt-2'><strong>Penyebab spesifik:</strong></p>
    <ul class='list-disc list

