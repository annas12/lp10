<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech - AI Voice Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .voice-card {
            transition: all 0.3s ease;
        }
        .voice-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">🎤 AI Voice Generator</h1>
            <p class="text-white/80 text-lg">Ubah teks menjadi suara dengan berbagai emosi dan karakter</p>
        </div>

        <!-- Main Card -->
        <div class="max-w-4xl mx-auto glass-effect rounded-2xl p-8 shadow-2xl">
            <!-- Backend Status -->
            <div class="mb-6">
                <div class="flex items-center justify-between bg-green-500/20 border border-green-500/50 rounded-lg p-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-400 rounded-full mr-3 pulse-animation"></div>
                        <span class="text-green-200 font-semibold">🔒 API Key tersimpan aman di Cloudflare Backend</span>
                    </div>
                    <span class="text-green-300 text-sm">✅ Terhubung</span>
                </div>
            </div>

            <!-- Text Input -->
            <div class="mb-6">
                <label class="block text-white font-semibold mb-2">📝 Teks yang akan diucapkan</label>
                <textarea id="textInput" rows="4" placeholder="Ketik teks yang ingin diubah menjadi suara..." 
                          class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none"></textarea>
            </div>

            <!-- Voice Selection -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- Voice Talent -->
                <div>
                    <label class="block text-white font-semibold mb-2">🎭 Pilih Talent Voice</label>
                    <select id="voiceSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="" class="bg-gray-800">Pilih Suara...</option>
                        <optgroup label="👩 Suara Perempuan" class="bg-gray-800">
                            <option value="female-1" class="bg-gray-800">Sarah - Suara Lembut</option>
                            <option value="female-2" class="bg-gray-800">Maya - Suara Energik</option>
                            <option value="female-3" class="bg-gray-800">Rina - Suara Profesional</option>
                            <option value="female-4" class="bg-gray-800">Dewi - Suara Hangat</option>
                        </optgroup>
                        <optgroup label="👨 Suara Laki-laki" class="bg-gray-800">
                            <option value="male-1" class="bg-gray-800">Andi - Suara Tegas</option>
                            <option value="male-2" class="bg-gray-800">Budi - Suara Ramah</option>
                            <option value="male-3" class="bg-gray-800">Candra - Suara Dalam</option>
                            <option value="male-4" class="bg-gray-800">Doni - Suara Muda</option>
                        </optgroup>
                    </select>
                </div>

                <!-- Emotion Preset -->
                <div>
                    <label class="block text-white font-semibold mb-2">😊 Preset Emosi</label>
                    <select id="emotionSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="neutral" class="bg-gray-800">😐 Netral</option>
                        <option value="happy" class="bg-gray-800">😊 Senang</option>
                        <option value="sad" class="bg-gray-800">😢 Sedih</option>
                        <option value="excited" class="bg-gray-800">🤩 Antusias</option>
                        <option value="calm" class="bg-gray-800">😌 Tenang</option>
                        <option value="serious" class="bg-gray-800">😤 Serius</option>
                        <option value="friendly" class="bg-gray-800">😄 Ramah</option>
                        <option value="mysterious" class="bg-gray-800">🤔 Misterius</option>
                    </select>
                </div>
            </div>

            <!-- Voice Settings -->
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-white font-semibold mb-2">🎵 Kecepatan</label>
                    <select id="speedSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="0.5" class="bg-gray-800">0.5x - Sangat Lambat</option>
                        <option value="0.75" class="bg-gray-800">0.75x - Lambat</option>
                        <option value="1" selected class="bg-gray-800">1x - Normal</option>
                        <option value="1.25" class="bg-gray-800">1.25x - Cepat</option>
                        <option value="1.5" class="bg-gray-800">1.5x - Sangat Cepat</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white font-semibold mb-2">🎚️ Nada</label>
                    <select id="pitchSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="-2" class="bg-gray-800">Sangat Rendah</option>
                        <option value="-1" class="bg-gray-800">Rendah</option>
                        <option value="0" selected class="bg-gray-800">Normal</option>
                        <option value="1" class="bg-gray-800">Tinggi</option>
                        <option value="2" class="bg-gray-800">Sangat Tinggi</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white font-semibold mb-2">🔊 Volume</label>
                    <select id="volumeSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="0.3" class="bg-gray-800">30% - Pelan</option>
                        <option value="0.5" class="bg-gray-800">50% - Sedang</option>
                        <option value="0.7" class="bg-gray-800">70% - Keras</option>
                        <option value="1" selected class="bg-gray-800">100% - Maksimal</option>
                    </select>
                </div>
            </div>

            <!-- Generate Button -->
            <div class="text-center mb-6">
                <button id="generateBtn" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
                    <span id="btnText">🎤 Generate Suara</span>
                </button>
            </div>

            <!-- Status -->
            <div id="status" class="text-center text-white/80 mb-4 hidden">
                <div class="inline-flex items-center">
                    <div class="pulse-animation mr-2">⏳</div>
                    <span class="loading-dots">Sedang memproses</span>
                </div>
            </div>

            <!-- Audio Player -->
            <div id="audioContainer" class="hidden">
                <div class="glass-effect rounded-xl p-6 text-center">
                    <h3 class="text-white font-semibold mb-4">🎵 Audio Hasil</h3>
                    <audio id="audioPlayer" controls class="w-full mb-4" style="filter: invert(1) hue-rotate(180deg);">
                        Audio tidak didukung oleh browser Anda.
                    </audio>
                    <div class="flex justify-center gap-4">
                        <button id="playBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                            ▶️ Putar
                        </button>
                        <button id="downloadBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            💾 Download
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-500/20 border border-red-500/50 rounded-lg p-4 text-red-200 text-center">
                <span id="errorText"></span>
            </div>
        </div>

        <!-- Info Card -->
        <div class="max-w-4xl mx-auto mt-6 glass-effect rounded-xl p-6">
            <h3 class="text-white font-semibold mb-3">ℹ️ Informasi Penting</h3>
            <div class="text-white/80 text-sm space-y-2">
                <p>• <strong>Backend Integration:</strong> API Key Google AI Studio tersimpan aman di Cloudflare Worker</p>
                <p>• <strong>Security:</strong> Tidak ada API key yang terekspos di frontend untuk keamanan maksimal</p>
                <p>• <strong>Endpoint:</strong> Aplikasi terhubung ke <code>https://text-to-speech-api.annasmashuri97.workers.dev/api/text-to-speech</code></p>
                <p>• <strong>Production Ready:</strong> Siap untuk deployment dengan konfigurasi Cloudflare Worker</p>
            </div>
        </div>
    </div>

    <script>
        // Voice data with characteristics
        const voiceData = {
            'female-1': { name: 'Sarah', gender: 'female', tone: 'soft', description: 'Suara lembut dan menenangkan' },
            'female-2': { name: 'Maya', gender: 'female', tone: 'energetic', description: 'Suara penuh energi dan semangat' },
            'female-3': { name: 'Rina', gender: 'female', tone: 'professional', description: 'Suara profesional dan jelas' },
            'female-4': { name: 'Dewi', gender: 'female', tone: 'warm', description: 'Suara hangat dan ramah' },
            'male-1': { name: 'Andi', gender: 'male', tone: 'firm', description: 'Suara tegas dan berwibawa' },
            'male-2': { name: 'Budi', gender: 'male', tone: 'friendly', description: 'Suara ramah dan mudah didekati' },
            'male-3': { name: 'Candra', gender: 'male', tone: 'deep', description: 'Suara dalam dan berkarakter' },
            'male-4': { name: 'Doni', gender: 'male', tone: 'young', description: 'Suara muda dan fresh' }
        };

        // Emotion settings
        const emotionSettings = {
            'neutral': { pitch: 0, speed: 1, description: 'Nada bicara normal' },
            'happy': { pitch: 0.5, speed: 1.1, description: 'Nada ceria dan optimis' },
            'sad': { pitch: -0.5, speed: 0.9, description: 'Nada sedih dan melankolis' },
            'excited': { pitch: 1, speed: 1.2, description: 'Nada antusias dan bersemangat' },
            'calm': { pitch: -0.2, speed: 0.8, description: 'Nada tenang dan damai' },
            'serious': { pitch: -0.3, speed: 0.95, description: 'Nada serius dan fokus' },
            'friendly': { pitch: 0.3, speed: 1.05, description: 'Nada ramah dan hangat' },
            'mysterious': { pitch: -0.8, speed: 0.85, description: 'Nada misterius dan dramatis' }
        };

        // DOM elements
        const textInput = document.getElementById('textInput');
        const voiceSelect = document.getElementById('voiceSelect');
        const emotionSelect = document.getElementById('emotionSelect');
        const speedSelect = document.getElementById('speedSelect');
        const pitchSelect = document.getElementById('pitchSelect');
        const volumeSelect = document.getElementById('volumeSelect');
        const generateBtn = document.getElementById('generateBtn');
        const btnText = document.getElementById('btnText');
        const status = document.getElementById('status');
        const audioContainer = document.getElementById('audioContainer');
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        // Backend configuration - API key is securely stored in Cloudflare Worker
        console.log('🔒 API Key dikonfigurasi di Cloudflare Worker untuk keamanan maksimal');

        // Generate speech function
        generateBtn.addEventListener('click', async function() {
            const text = textInput.value.trim();
            const selectedVoice = voiceSelect.value;
            const selectedEmotion = emotionSelect.value;

            // Validation
            if (!text) {
                showError('Harap masukkan teks yang ingin diubah menjadi suara');
                return;
            }

            if (!selectedVoice) {
                showError('Harap pilih talent voice terlebih dahulu');
                return;
            }

            // Hide previous results and errors
            hideError();
            audioContainer.classList.add('hidden');

            // Show loading state
            showLoading();

            try {
                // Call Cloudflare Worker endpoint
                const response = await fetch('https://text-to-speech-api.annasmashuri97.workers.dev/api/text-to-speech', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        voice: selectedVoice,
                        emotion: selectedEmotion,
                        speed: parseFloat(speedSelect.value),
                        pitch: parseFloat(pitchSelect.value),
                        volume: parseFloat(volumeSelect.value)
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Get audio blob from response
                const audioBlob = await response.blob();
                
                // Create audio URL
                const audioUrl = URL.createObjectURL(audioBlob);
                audioPlayer.src = audioUrl;

                // Show audio player
                audioContainer.classList.remove('hidden');
                
                // Setup download
                setupDownload(audioBlob, text);

                hideLoading();
                
            } catch (error) {
                hideLoading();
                showError('Terjadi kesalahan saat memproses audio: ' + error.message);
            }
        });

        // Generate sample audio (demo purposes)
        async function generateSampleAudio(text, voice, emotion) {
            // Create a simple audio context for demo
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const sampleRate = audioContext.sampleRate;
            const duration = Math.max(2, text.length * 0.1); // Estimate duration based on text length
            const frameCount = sampleRate * duration;
            
            const audioBuffer = audioContext.createBuffer(1, frameCount, sampleRate);
            const channelData = audioBuffer.getChannelData(0);
            
            // Generate a simple tone pattern (for demo)
            const voiceInfo = voiceData[voice];
            const emotionInfo = emotionSettings[emotion];
            
            let frequency = voiceInfo.gender === 'female' ? 220 : 110; // Base frequency
            frequency += emotionInfo.pitch * 50; // Adjust for emotion
            
            for (let i = 0; i < frameCount; i++) {
                // Create a simple waveform that varies based on text content
                const t = i / sampleRate;
                const textIndex = Math.floor((t / duration) * text.length);
                const char = text.charCodeAt(textIndex % text.length) || 65;
                const charFreq = frequency + (char - 65) * 2;
                
                channelData[i] = Math.sin(2 * Math.PI * charFreq * t) * 0.1 * Math.exp(-t * 0.5);
            }
            
            // Convert to WAV blob
            return audioBufferToWav(audioBuffer);
        }

        // Convert AudioBuffer to WAV blob
        function audioBufferToWav(buffer) {
            const length = buffer.length;
            const arrayBuffer = new ArrayBuffer(44 + length * 2);
            const view = new DataView(arrayBuffer);
            const channelData = buffer.getChannelData(0);
            
            // WAV header
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, buffer.sampleRate, true);
            view.setUint32(28, buffer.sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, length * 2, true);
            
            // Convert float samples to 16-bit PCM
            let offset = 44;
            for (let i = 0; i < length; i++) {
                const sample = Math.max(-1, Math.min(1, channelData[i]));
                view.setInt16(offset, sample * 0x7FFF, true);
                offset += 2;
            }
            
            return new Blob([arrayBuffer], { type: 'audio/wav' });
        }

        // Setup download functionality
        function setupDownload(audioBlob, text) {
            downloadBtn.onclick = function() {
                const url = URL.createObjectURL(audioBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tts_${text.substring(0, 20).replace(/[^a-zA-Z0-9]/g, '_')}.wav`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };
        }

        // Play button functionality
        playBtn.addEventListener('click', function() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playBtn.innerHTML = '⏸️ Pause';
            } else {
                audioPlayer.pause();
                playBtn.innerHTML = '▶️ Putar';
            }
        });

        // Audio player event listeners
        audioPlayer.addEventListener('play', function() {
            playBtn.innerHTML = '⏸️ Pause';
        });

        audioPlayer.addEventListener('pause', function() {
            playBtn.innerHTML = '▶️ Putar';
        });

        audioPlayer.addEventListener('ended', function() {
            playBtn.innerHTML = '▶️ Putar';
        });

        // Utility functions
        function showLoading() {
            generateBtn.disabled = true;
            btnText.textContent = 'Memproses...';
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            status.classList.remove('hidden');
        }

        function hideLoading() {
            generateBtn.disabled = false;
            btnText.textContent = '🎤 Generate Suara';
            generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            status.classList.add('hidden');
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(hideError, 5000);
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        // Voice selection change handler
        voiceSelect.addEventListener('change', function() {
            if (this.value && voiceData[this.value]) {
                const voice = voiceData[this.value];
                // You could show voice preview or description here
                console.log(`Selected voice: ${voice.name} (${voice.description})`);
            }
        });

        // Emotion selection change handler
        emotionSelect.addEventListener('change', function() {
            if (this.value && emotionSettings[this.value]) {
                const emotion = emotionSettings[this.value];
                // Auto-adjust speed and pitch based on emotion
                speedSelect.value = emotion.speed;
                pitchSelect.value = emotion.pitch;
                console.log(`Selected emotion: ${this.value} (${emotion.description})`);
            }
        });

        // Sample text suggestions
        const sampleTexts = [
            "Halo, selamat datang di aplikasi text to speech kami!",
            "Teknologi AI memungkinkan kita mengubah teks menjadi suara yang natural.",
            "Hari ini cuaca sangat cerah dan menyenangkan untuk beraktivitas.",
            "Terima kasih telah menggunakan layanan kami. Semoga hari Anda menyenangkan!"
        ];

        // Add sample text on empty input focus
        textInput.addEventListener('focus', function() {
            if (!this.value.trim()) {
                const randomText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
                this.placeholder = randomText;
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9870e084b23e9fd7',t:'MTc1OTIwNTQ5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
