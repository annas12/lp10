<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech - AI Voice Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .voice-card {
            transition: all 0.3s ease;
        }
        .voice-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">🎤 AI Voice Generator</h1>
            <p class="text-white/80 text-lg">Powered by Gemini 2.5 Pro TTS - Kualitas suara terbaik dengan AI</p>
        </div>

        <!-- Main Card -->
        <div class="max-w-4xl mx-auto glass-effect rounded-2xl p-8 shadow-2xl">

            <!-- API Status (Hidden Setup) -->
            <div class="mb-6">
                <div class="bg-gradient-to-r from-green-500/20 to-blue-500/20 border border-green-500/50 rounded-lg p-4 text-center">
                    <div id="apiStatus" class="text-green-300 text-sm">
                        ✅ Gemini 2.5 Pro TTS siap digunakan
                    </div>
                </div>
            </div>

            <!-- Text Input -->
            <div class="mb-6">
                <label class="block text-white font-semibold mb-2">📝 Teks yang akan diucapkan</label>
                <textarea id="textInput" rows="4" placeholder="Ketik teks yang ingin diubah menjadi suara..." 
                          class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none"></textarea>
            </div>

            <!-- Voice Selection -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- Voice Talent -->
                <div>
                    <label class="block text-white font-semibold mb-2">🎭 Pilih Voice Model</label>
                    <select id="voiceSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="" class="bg-gray-800">Pilih Suara...</option>
                        <optgroup label="🤖 Gemini Premium Voices" class="bg-gray-800">
                            <option value="Zephyr" class="bg-gray-800">Zephyr - Suara Profesional</option>
                            <option value="Puck" class="bg-gray-800">Puck - Suara Ramah</option>
                            <option value="Charon" class="bg-gray-800">Charon - Suara Dalam</option>
                            <option value="Kore" class="bg-gray-800">Kore - Suara Lembut</option>
                            <option value="Fenrir" class="bg-gray-800">Fenrir - Suara Tegas</option>
                            <option value="Aoede" class="bg-gray-800">Aoede - Suara Melodis</option>
                        </optgroup>
                    </select>
                    
                    <!-- Voice Preview -->
                    <div id="voicePreview" class="mt-3 hidden">
                        <div class="glass-effect rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span id="voicePreviewName" class="text-white font-medium"></span>
                                <button id="previewBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                    🔊 Preview
                                </button>
                            </div>
                            <p id="voicePreviewDesc" class="text-white/70 text-sm"></p>
                            <audio id="previewPlayer" class="hidden"></audio>
                        </div>
                    </div>
                </div>

                <!-- Speaking Style -->
                <div>
                    <label class="block text-white font-semibold mb-2">🎭 Gaya Bicara</label>
                    <select id="styleSelect" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="conversational" class="bg-gray-800">💬 Percakapan</option>
                        <option value="narrative" class="bg-gray-800">📖 Naratif</option>
                        <option value="expressive" class="bg-gray-800">🎭 Ekspresif</option>
                        <option value="calm" class="bg-gray-800">😌 Tenang</option>
                        <option value="energetic" class="bg-gray-800">⚡ Energik</option>
                        <option value="professional" class="bg-gray-800">👔 Profesional</option>
                    </select>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="mb-6">
                <details class="glass-effect rounded-lg p-4">
                    <summary class="text-white font-semibold cursor-pointer">⚙️ Pengaturan Lanjutan</summary>
                    <div class="grid md:grid-cols-3 gap-4 mt-4">
                        <div>
                            <label class="block text-white font-medium mb-2">🎵 Kecepatan</label>
                            <input type="range" id="speedRange" min="0.5" max="2" step="0.1" value="1" 
                                   class="w-full accent-blue-500">
                            <div class="text-white/70 text-sm text-center mt-1">
                                <span id="speedValue">1.0x</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-white font-medium mb-2">🎚️ Nada</label>
                            <input type="range" id="pitchRange" min="-20" max="20" step="1" value="0" 
                                   class="w-full accent-blue-500">
                            <div class="text-white/70 text-sm text-center mt-1">
                                <span id="pitchValue">0</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-white font-medium mb-2">🔊 Volume</label>
                            <input type="range" id="volumeRange" min="0" max="100" step="5" value="80" 
                                   class="w-full accent-blue-500">
                            <div class="text-white/70 text-sm text-center mt-1">
                                <span id="volumeValue">80%</span>
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Generate Button -->
            <div class="text-center mb-6">
                <button id="generateBtn" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
                    <span id="btnText">🎤 Generate Suara AI</span>
                </button>
            </div>

            <!-- Status -->
            <div id="status" class="text-center text-white/80 mb-4 hidden">
                <div class="inline-flex items-center">
                    <div class="pulse-animation mr-2">⏳</div>
                    <span class="loading-dots">Sedang memproses dengan Gemini AI</span>
                </div>
            </div>

            <!-- Audio Player -->
            <div id="audioContainer" class="hidden">
                <div class="glass-effect rounded-xl p-6 text-center">
                    <h3 class="text-white font-semibold mb-4">🎵 Audio Hasil Gemini TTS</h3>
                    <audio id="audioPlayer" controls class="w-full mb-4" style="filter: invert(1) hue-rotate(180deg);">
                        Audio tidak didukung oleh browser Anda.
                    </audio>
                    <div class="flex justify-center gap-4">
                        <button id="playBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                            ▶️ Putar
                        </button>
                        <button id="downloadBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            💾 Download
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-500/20 border border-red-500/50 rounded-lg p-4 text-red-200 text-center">
                <span id="errorText"></span>
            </div>

            <!-- Features Info -->
            <div class="mt-8 grid md:grid-cols-3 gap-4 text-center">
                <div class="glass-effect rounded-lg p-4">
                    <div class="text-2xl mb-2">🚀</div>
                    <h4 class="text-white font-semibold mb-1">Gemini 2.5 Pro</h4>
                    <p class="text-white/70 text-sm">Teknologi TTS terbaru dari Google</p>
                </div>
                <div class="glass-effect rounded-lg p-4">
                    <div class="text-2xl mb-2">🎭</div>
                    <h4 class="text-white font-semibold mb-1">Multi Voice</h4>
                    <p class="text-white/70 text-sm">6 karakter suara premium</p>
                </div>
                <div class="glass-effect rounded-lg p-4">
                    <div class="text-2xl mb-2">🌍</div>
                    <h4 class="text-white font-semibold mb-1">Bahasa Indonesia</h4>
                    <p class="text-white/70 text-sm">Dukungan natural untuk bahasa lokal</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-preview-tts:streamGenerateContent';
        
        // Voice data for Gemini TTS
        const geminiVoices = {
            'Zephyr': { 
                name: 'Zephyr', 
                description: 'Suara profesional dan jelas, cocok untuk presentasi dan narasi formal',
                gender: 'neutral',
                tone: 'professional'
            },
            'Puck': { 
                name: 'Puck', 
                description: 'Suara ramah dan hangat, ideal untuk percakapan dan konten kasual',
                gender: 'neutral',
                tone: 'friendly'
            },
            'Charon': { 
                name: 'Charon', 
                description: 'Suara dalam dan berwibawa, sempurna untuk konten serius',
                gender: 'neutral',
                tone: 'deep'
            },
            'Kore': { 
                name: 'Kore', 
                description: 'Suara lembut dan menenangkan, cocok untuk meditasi dan relaksasi',
                gender: 'neutral',
                tone: 'soft'
            },
            'Fenrir': { 
                name: 'Fenrir', 
                description: 'Suara tegas dan berkarakter, ideal untuk konten motivasi',
                gender: 'neutral',
                tone: 'firm'
            },
            'Aoede': { 
                name: 'Aoede', 
                description: 'Suara melodis dan ekspresif, sempurna untuk storytelling',
                gender: 'neutral',
                tone: 'melodic'
            }
        };

        // Speaking styles
        const speakingStyles = {
            'conversational': { description: 'Gaya percakapan natural dan santai' },
            'narrative': { description: 'Gaya bercerita yang engaging' },
            'expressive': { description: 'Gaya ekspresif dengan emosi yang kuat' },
            'calm': { description: 'Gaya tenang dan menenangkan' },
            'energetic': { description: 'Gaya penuh energi dan semangat' },
            'professional': { description: 'Gaya formal dan profesional' }
        };

        // DOM elements
        const textInput = document.getElementById('textInput');
        const voiceSelect = document.getElementById('voiceSelect');
        const styleSelect = document.getElementById('styleSelect');
        const speedRange = document.getElementById('speedRange');
        const pitchRange = document.getElementById('pitchRange');
        const volumeRange = document.getElementById('volumeRange');
        const speedValue = document.getElementById('speedValue');
        const pitchValue = document.getElementById('pitchValue');
        const volumeValue = document.getElementById('volumeValue');
        const generateBtn = document.getElementById('generateBtn');
        const btnText = document.getElementById('btnText');
        const status = document.getElementById('status');
        const audioContainer = document.getElementById('audioContainer');
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const voicePreview = document.getElementById('voicePreview');
        const voicePreviewName = document.getElementById('voicePreviewName');
        const voicePreviewDesc = document.getElementById('voicePreviewDesc');
        const previewBtn = document.getElementById('previewBtn');
        const previewPlayer = document.getElementById('previewPlayer');
        const apiStatus = document.getElementById('apiStatus');
        
        // Store API key - Ganti 'YOUR_API_KEY_HERE' dengan API key Gemini Anda
        let geminiApiKey = 'AIzaSyBYTWnUZL5vGi0XLHX29ppOCWIGWTMcxao'; // Masukkan API key Gemini Anda di sini

        // API key sudah tertanam dalam kode
        console.log('🔑 API key loaded from code');

        // Range input handlers
        speedRange.addEventListener('input', function() {
            speedValue.textContent = this.value + 'x';
        });

        pitchRange.addEventListener('input', function() {
            pitchValue.textContent = this.value;
        });

        volumeRange.addEventListener('input', function() {
            volumeValue.textContent = this.value + '%';
        });

        // Voice selection handler
        voiceSelect.addEventListener('change', function() {
            if (this.value && geminiVoices[this.value]) {
                const voice = geminiVoices[this.value];
                voicePreviewName.textContent = voice.name;
                voicePreviewDesc.textContent = voice.description;
                voicePreview.classList.remove('hidden');
            } else {
                voicePreview.classList.add('hidden');
            }
        });

        // Preview button handler
        previewBtn.addEventListener('click', async function() {
            const selectedVoice = voiceSelect.value;
            if (!selectedVoice) {
                showError('Harap pilih voice terlebih dahulu');
                return;
            }

            if (!geminiApiKey || geminiApiKey === 'YOUR_API_KEY_HERE') {
                showError('API key belum dikonfigurasi dalam kode');
                return;
            }

            const originalText = previewBtn.textContent;
            previewBtn.textContent = '⏳ Loading...';
            previewBtn.disabled = true;

            try {
                const voice = geminiVoices[selectedVoice];
                const previewText = `Halo, saya ${voice.name}. ${voice.description}`;
                
                const audioBlob = await generateGeminiTTS(previewText, selectedVoice, true);
                
                if (audioBlob) {
                    const audioUrl = URL.createObjectURL(audioBlob);
                    previewPlayer.src = audioUrl;
                    
                    previewPlayer.onloadeddata = function() {
                        previewPlayer.play().catch(err => {
                            console.error('Error playing preview:', err);
                            showError('Tidak dapat memutar preview audio');
                        });
                    };
                    
                    previewPlayer.addEventListener('ended', function() {
                        URL.revokeObjectURL(audioUrl);
                    }, { once: true });
                }

            } catch (error) {
                console.error('Error generating preview:', error);
                showError('Error generating preview: ' + error.message);
            }

            previewBtn.textContent = originalText;
            previewBtn.disabled = false;
        });

        // Main generate function
        generateBtn.addEventListener('click', async function() {
            const text = textInput.value.trim();
            const selectedVoice = voiceSelect.value;

            // Validation
            if (!text) {
                showError('Harap masukkan teks yang ingin diubah menjadi suara');
                return;
            }

            if (!selectedVoice) {
                showError('Harap pilih voice model terlebih dahulu');
                return;
            }

            if (!geminiApiKey || geminiApiKey === 'YOUR_API_KEY_HERE') {
                showError('API key belum dikonfigurasi. Harap ganti YOUR_API_KEY_HERE dengan API key Gemini Anda');
                return;
            }

            // Hide previous results and errors
            hideError();
            audioContainer.classList.add('hidden');

            // Show loading state
            showLoading();

            try {
                const audioBlob = await generateGeminiTTS(text, selectedVoice, false);
                
                if (audioBlob) {
                    // Create audio URL
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPlayer.src = audioUrl;

                    // Show audio player
                    audioContainer.classList.remove('hidden');
                    
                    // Setup download
                    setupDownload(audioBlob, text);

                    console.log('✅ Audio berhasil dimuat dan siap diputar');
                } else {
                    throw new Error('Gagal menghasilkan audio');
                }
                
            } catch (error) {
                console.error('❌ Error dalam generate speech:', error);
                showError('Terjadi kesalahan saat memproses audio: ' + error.message);
            }

            hideLoading();
        });

        // Generate TTS using Gemini API
        async function generateGeminiTTS(text, voiceName, isPreview = false) {
            try {
                console.log('🎤 Generating TTS with Gemini...', { text: text.substring(0, 50), voiceName, isPreview });

                const payload = {
                    contents: [{
                        role: 'user',
                        parts: [{
                            text: text
                        }]
                    }],
                    generationConfig: {
                        responseModalities: ['audio'],
                        temperature: 0.7,
                        speech_config: {
                            voice_config: {
                                prebuilt_voice_config: {
                                    voice_name: voiceName
                                }
                            }
                        }
                    }
                };

                const response = await fetch(`${GEMINI_API_URL}?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                console.log('📥 Gemini response status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('❌ Gemini API error:', errorText);
                    throw new Error(`Gemini API error: ${response.status} - ${errorText}`);
                }

                const responseText = await response.text();
                console.log('📄 Raw response length:', responseText.length);

                // Parse streaming response
                const chunks = responseText.trim().split('\n').filter(line => line.trim());
                let audioData = null;

                for (const chunk of chunks) {
                    try {
                        const parsed = JSON.parse(chunk);
                        console.log('📦 Processing chunk:', Object.keys(parsed));
                        
                        if (parsed.candidates?.[0]?.content?.parts?.[0]?.inlineData) {
                            const inlineData = parsed.candidates[0].content.parts[0].inlineData;
                            if (inlineData.mimeType && inlineData.mimeType.includes('audio') && inlineData.data) {
                                audioData = inlineData.data;
                                console.log('🎵 Found audio data, length:', audioData.length);
                                break;
                            }
                        }
                    } catch (parseError) {
                        console.log('⚠️ Skipping non-JSON chunk:', chunk.substring(0, 100));
                    }
                }

                if (!audioData) {
                    throw new Error('Tidak ada data audio dalam response Gemini');
                }

                // Convert base64 to blob
                const binaryString = atob(audioData);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }

                const audioBlob = new Blob([bytes], { type: 'audio/wav' });
                console.log('✅ Audio blob created, size:', audioBlob.size, 'bytes');

                return audioBlob;

            } catch (error) {
                console.error('❌ Error in generateGeminiTTS:', error);
                throw error;
            }
        }

        // Setup download functionality
        function setupDownload(audioBlob, text) {
            downloadBtn.onclick = function() {
                const url = URL.createObjectURL(audioBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `gemini_tts_${text.substring(0, 20).replace(/[^a-zA-Z0-9]/g, '_')}.wav`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };
        }

        // Play button functionality
        playBtn.addEventListener('click', function() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playBtn.innerHTML = '⏸️ Pause';
            } else {
                audioPlayer.pause();
                playBtn.innerHTML = '▶️ Putar';
            }
        });

        // Audio player event listeners
        audioPlayer.addEventListener('play', function() {
            playBtn.innerHTML = '⏸️ Pause';
        });

        audioPlayer.addEventListener('pause', function() {
            playBtn.innerHTML = '▶️ Putar';
        });

        audioPlayer.addEventListener('ended', function() {
            playBtn.innerHTML = '▶️ Putar';
        });

        // Utility functions
        function showLoading() {
            generateBtn.disabled = true;
            btnText.textContent = 'Memproses dengan Gemini AI...';
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            status.classList.remove('hidden');
        }

        function hideLoading() {
            generateBtn.disabled = false;
            btnText.textContent = '🎤 Generate Suara AI';
            generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            status.classList.add('hidden');
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(hideError, 8000);
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        // Sample text suggestions
        const sampleTexts = [
            "Halo, selamat datang di era baru text-to-speech dengan teknologi Gemini AI!",
            "Teknologi kecerdasan buatan telah mengubah cara kita berinteraksi dengan komputer.",
            "Hari ini adalah hari yang indah untuk menjelajahi kemampuan suara AI yang menakjubkan.",
            "Terima kasih telah menggunakan Gemini TTS. Nikmati pengalaman suara berkualitas tinggi!"
        ];

        // Add sample text on empty input focus
        textInput.addEventListener('focus', function() {
            if (!this.value.trim()) {
                const randomText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
                this.placeholder = randomText;
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98712d8ec2566097',t:'MTc1OTIwODY1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
